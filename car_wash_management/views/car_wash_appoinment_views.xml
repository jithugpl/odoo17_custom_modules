<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Action to open appointment views -->
    <record id="action_car_wash_appointment" model="ir.actions.act_window">
        <field name="name">Car Wash Appointments</field>
        <field name="res_model">car.wash.appointment</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Add menu item under "Wash" -->
    <menuitem id="menu_car_wash_appointments" name="Appointments"
              parent="menu_car_wash_main" action="action_car_wash_appointment" sequence="3"/>

    <!-- Tree View -->
    <record id="view_car_wash_appointment_tree" model="ir.ui.view">
        <field name="name">car.wash.appointment.tree</field>
        <field name="model">car.wash.appointment</field>
        <field name="arch" type="xml">
            <tree string="Car Wash Appointments">
                <field name="in_time"/>
                <field name="customer_id"/>
                <field name="vehicle_number_id"/>
                <!--                <field name="vehicle_number"/>-->
                <field name="vehicle_type_id"/>
                <field name="rate" readonly="1"/>
                <field name="wash_type_id"/>
                <field name="employee_id"/>
                <field name="state" widget="badge"
                       decoration-success="state == 'new'"
                       decoration-info="state == 'started'"
                       decoration-muted="state == 'pending'"
                       decoration-danger="state == 'finished'
                       "/>
            </tree>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_car_wash_appointment_form" model="ir.ui.view">
        <field name="name">car.wash.appointment.form</field>
        <field name="model">car.wash.appointment</field>
        <field name="arch" type="xml">
            <form string="Car Wash Appointment">
                <header>
                    <button name="action_start" string="Start" type="object"
                            class="btn-primary"/>
                    <button name="action_pending" string="Pending" type="object"
                            class="btn-warning"/>
                    <button name="action_finish" string="Finish" type="object"
                            class="btn-success"/>
                    <button name="action_deliver" string="Deliver" type="object"
                            class="btn-secondary"/>
                    <field name="state" widget="statusbar" statusbar_visible="new,started,pending,finished,delivered"/>
                </header>

                <sheet>
                    <group>
                        <group class="custom-group-bg">
                            <field name="vehicle_number_id"/>
                            <field name="in_time"/>
                            <field name="customer_id"/>
                            <field name="customer_mobile" readonly="1"/>
                            <!--                        <field name="vehicle_number"/>-->
                            <!--                        <field name="vehicle_type_id"/>-->
                            <!--                        <field name="rate"/>-->
                            <!--                        <field name="discount"/>-->
                            <!--                        <field name="wash_type_id"/>-->
                            <field name="employee_id"/>
                        </group>
                        <group>
                            <group string="Pickup and Drop">
                                <field name="is_pickup"/>
                            </group>

                            <group string="Pickup Details" invisible="not is_pickup">
                                <field name="pickup_employee_id"/>
                                <field name="pickup_time"/>
                                <field name="drop_employee_id"/>
                                <field name="drop_time"/>
                            </group>
                        </group>
                    </group>


                    <notebook>
                        <page string="Billing">
                            <field name="billing_line_ids" mode="tree" context="{'default_appointment_id': active_id}">
                                <tree editable="bottom">
                                    <field name="wash_type_id"/>
                                    <field name="vehicle_type_id"/>
                                    <field name="rate"/>
                                    <field name="discount"/>
                                    <field name="discount_amount" readonly="1"/>
                                    <field name="total_amount" readonly="1"/>
                                </tree>
                            </field>
                            <field name="product_line_ids">
                                <tree editable="bottom">
                                    <field name="product_id"/>
                                    <field name="uom_id"/>
                                    <field name="quantity"/>
                                    <field name="price_unit"/>
                                    <field name="subtotal" readonly="1"/>
                                </tree>
                            </field>

                            <div style="text-align:right; padding-top: 10px; font-size: 16px; font-weight: bold; color: #004aad;">
                                <h5>Total Amount:</h5>
                                <field name="total_amount" readonly="1"/>
                            </div>
                            <!-- Use a group to show subtotal below -->
                            <!--                            <group>-->
                            <!--                                <field name="subtotal_amount" readonly="1"-->
                            <!--                                       style="font-size: 16px; font-weight: bold; color: #004aad; text-align: right;"/>-->
                            <!--                            </group>-->
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>
</odoo>
