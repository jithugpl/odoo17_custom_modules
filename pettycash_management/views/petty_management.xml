<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
 <record id="petty_cash_management_tree" model="ir.ui.view">
        <field name="name">Petty Cash Management Tree</field>
        <field name="model">petty.cash.management</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="date"/>
                <field name="account_id"/>
                <field name="project"/>
                <field name="total"/>
                <field name="state" widget='badge' decoration-bf="state == 'draft'" decoration-success="state == 'post'"
                       decoration-info="state =='confirm'" decoration-danger="state == 'review'" decoration-warning="state == 'verified'"/>
            </tree>
        </field>
    </record>


    <record id="petty_cash_management_form" model="ir.ui.view">
        <field name="name">Petty Cash Management</field>
        <field name="model">petty.cash.management</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_confirm" string="Confirm" class="btn-primary" invisible="state!='draft'" type="object" groups="pettycash_management.group_petty_cash_user,pettycash_management.group_petty_cash_reviewer,pettycash_management.group_petty_cash_verifier,pettycash_management.group_petty_cash_accountant"/>
                    <button name="action_post" string="Post" class="btn-primary"  invisible="state!='verified'" type="object" groups="pettycash_management.group_petty_cash_accountant"/>
                    <button name="action_review" string="Review" class="btn-primary" invisible="state in ['review','post','draft','cancel']" type="object" groups="pettycash_management.group_petty_cash_reviewer,pettycash_management.group_petty_cash_verifier,pettycash_management.group_petty_cash_accountant"/>
                    <button name="action_verify" string="Verify" class="btn-primary" invisible="state in ['draft','confirm','verified','cancel','post']" type="object" groups="pettycash_management.group_petty_cash_verifier,pettycash_management.group_petty_cash_accountant"/>
                    <button name="action_draft" string="Reset To Draft"  invisible="state in ['draft']" type="object"  groups="pettycash_management.group_petty_cash_user,pettycash_management.group_petty_cash_reviewer,pettycash_management.group_petty_cash_verifier,pettycash_management.group_petty_cash_accountant"/>
                    <button name="action_cancel" string="Cancel" invisible="state in ['cancel','post']" type="object" groups="pettycash_management.group_petty_cash_user,pettycash_management.group_petty_cash_reviewer,pettycash_management.group_petty_cash_verifier,pettycash_management.group_petty_cash_accountant"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirm,post,review,verified"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button"  type="object" name="action_journal_entries" icon="fa-book"  invisible="state !='post'">
                           <field name="journal_id" widget="statinfo" string="Journal Entries"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="account_id" options="{'no_create': True, 'no_open': True}"  readonly="state in [ 'post','cancel']" domain="[('cash_account_selection','=','True')]"/>
                             <field name="project" string="Project" readonly="state in [ 'post','cancel']"/>
                        </group>
                        <group>
                            <field name="date" required="1" readonly="state in [ 'post','cancel']"/>
                            <field name="journal_id" required="1" options="{'no_create': True, 'no_open': True}" readonly="state in [ 'post','cancel']" domain="[('petty_cash_site_limit','=','True')]"/>
                            <field name="move_id" required="1" invisible="[('move_id','=','False')]"/>
                            <field name="remarks" readonly="state in [ 'post','cancel']"/>

                            <field name="company_id" invisible="1"/>
                        </group>
                    </group>
                   <notebook>
                       <page string="Petty Cash Lines" name="petty_cash_management_lines">
                           <field name="petty_cash_lines_ids" readonly="state in [ 'confirm','post','cancel']">
                               <tree editable="bottom">
                              <field name="product" domain="[('can_be_expensed','=','True')]"  string="Product"/>

                                   <field name="account_id"   options="{'no_create': True, 'no_open': True}"/>
<!--                                   domain="[('petty_cash_selection', '=', True)]"-->

                                   <field name="amount" force_save="1"/>
                                   <field name="narration"/>
                                   <field name="project_id"/>
                               </tree>

                           </field>
                           <group class="oe_subtotal_footer oe_right">
                               <field name="total" class="oe_subtotal_footer_separator"/>
                               <field name="currency_id" invisible="1"/>
                           </group>
                       </page>
                   </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>


    <record id="petty_cash_management_action" model="ir.actions.act_window">
        <field name="name">Petty Cash Management</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">petty.cash.management</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_noncontent_smiling_face">
                Create a new Petty Cash Management action!
            </p>
        </field>
    </record>


    <menuitem id="petty_sub_menu"
              name="Petty Cash"
              parent="project.menu_main_pm"
              action="petty_cash_management_action"
              sequence="5"/>
    <menuitem id="petty_sub_menu_accounting"
              name="Petty Cash"
              parent="account.menu_finance_entries"
              action="petty_cash_management_action"
              sequence="5"/>
</odoo>